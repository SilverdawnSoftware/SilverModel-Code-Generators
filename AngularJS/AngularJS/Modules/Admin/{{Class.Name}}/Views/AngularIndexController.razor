@using SilvaDawn.SilvaModel.UML.Extensions;
@using SilvaDawn.SilvaModel.UML.Interfaces.Classes;
@using SilvaDawn.SilvaModel.UML.Classes;
// ALLOWOVERWRITE
module @Model.Model.QualifiedName {


    export interface I@{@Model.Class.Name}IndexCtrlScope extends ng.IScope {
        loaded: boolean;
        @(Model.Class.Name.LowerFirst())Views: I@(Model.Class.Name)View[];
      
    }

    export class @{@Model.Class.Name}IndexCtrl {
        public static $inject = [
            '$scope',
            '@Model.Class.Name.LowerFirst()Service'        
        ];

        constructor(private $scope: I@{@Model.Class.Name}IndexCtrlScope, private @Model.Class.Name.LowerFirst()Service: @(Model.Class.Name)Service    ) {
            var count = 0;
            var toLoad = 1;
            $scope.loaded = false;

            function dataLoaded() {
                count++;
                if (count >= toLoad) {
                    $scope.loaded = true;
                }
            }

           
            @Model.Class.Name.LowerFirst()Service.get@(Model.Class.Name)s().then(function(data: I@{@Model.Class.Name}View[]) {
                $scope.@(Model.Class.Name.LowerFirst())Views = data;
                dataLoaded();
            });
            
        
        }
    }

    angular.module("CompareEngine").controller("@(Model.Class.Name.LowerFirst())IndexCtrl", @(Model.Class.Name)IndexCtrl).config([
        "$routeProvider", function($routeProvider) {
            $routeProvider.when("/Admin/@Model.Model.QualifiedName/@Model.Class.Name/Index", {
                templateUrl: "/AngularJS/Modules/Admin/@Model.Class.Name/Views/@(Model.Class.Name)Index.html",
                controller: "@(Model.Class.Name.LowerFirst())IndexCtrl"
            });
        }
    ]);
};


@functions{

string GetPrimaryKey(IClass iClass)
{
	foreach (var att2 in iClass.OwnedAttributes)
   	{
		if (att2["EF4","EF Primary Key"]=="True")
		 return att2.Name;
	}
	
	return "";
}

string GetDescriptor(IClass iClass)
{
	foreach (var att2 in iClass.OwnedAttributes)
   	{
		if (att2["EF4","Default Descriptor"]=="True")
		 return att2.Name;
	}
	
	return "";
}

}

