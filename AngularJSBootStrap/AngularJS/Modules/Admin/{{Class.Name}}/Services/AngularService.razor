@using SilvaDawn.SilvaModel.UML.Extensions;
@using SilvaDawn.SilvaModel.UML.Interfaces.Classes;
@using SilvaDawn.SilvaModel.UML.Classes;
// ALLOWOVERWRITE

@{
var primaryKey=GetPrimaryKey(Model.Class);
}

module @Model.Model.QualifiedName {


    export class @(Model.Class.Name)Service {

        public static $inject = ['$http', '$q', '$log', '$rootScope'];

        constructor(private $http: ng.IHttpService, private $q: ng.IQService, private $log: ng.ILogService) {}


		get@(Model.Class.Name)s(): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.get('api/@(Model.Class.Name)/All')
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }


		@if (!string.IsNullOrEmpty(primaryKey))
		{
	 	<text>get@(Model.Class.Name)(@(GetPrimaryKey(Model.Class).LowerFirst()): number): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.get('api/@(Model.Class.Name)/'+@(GetPrimaryKey(Model.Class).LowerFirst()))
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }
	        
		@foreach (var att in Model.Class.GetTargetAssociation())
	    	{
	    		var parent=(IClass)att.GetSourceMemberEnd().Type;
	    		var parentKey=GetPrimaryKey(parent);
			
			<text>
			get@(Model.Class.Name)sFor@(parent.Name)(@(parentKey.LowerFirst()): number): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.get('api/@(parent.Name)/'+@(parentKey.LowerFirst())+'/@(Model.Class.Name)s')
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }
	</text>    	
	    	}
	
	
	
			add@(Model.Class.Name)(add: @(Model.Class.Name)View): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.post('api/@(Model.Class.Name)',add)
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }

			update@(Model.Class.Name)(update: @(Model.Class.Name)View): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.put('api/@(Model.Class.Name)/'+update.@(GetPrimaryKey(Model.Class)),update)
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }	
			delete@(Model.Class.Name)(@(GetPrimaryKey(Model.Class).LowerFirst()): number): ng.IPromise<any> {
	            var deferred = this.$q.defer();
	
	            this.$http.delete('api/@(Model.Class.Name)/'+@(GetPrimaryKey(Model.Class).LowerFirst()))
	                .success(function (data) {
	                deferred.resolve(data);
	            }).error(function (msg, code) {
	                deferred.reject(msg);
	                this.$log.error(msg, code);
	            });
	            return deferred.promise;
	        }	</text>
}



    }
   	angular.module("@Model.Model.QualifiedName").service('@(Model.Class.Name.LowerFirst())Service', @(Model.Class.Name)Service);

}
	


@functions{
 
    public static string GetPrimaryKey(IClass umlClass)
    {
    	foreach (var att in umlClass.OwnedAttributes)
		{
			if (att["EF4","EF Primary Key"]=="True")
			{
				return att.Name;
			}
		}
    	
    	return "";
    }
 
}

