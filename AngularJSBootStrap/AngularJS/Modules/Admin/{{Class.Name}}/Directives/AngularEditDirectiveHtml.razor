@using SilvaDawn.SilvaModel.UML.Extensions;
@using SilvaDawn.SilvaModel.UML.Interfaces.Classes;
@using SilvaDawn.SilvaModel.UML.Classes;
<div class="box-content">

    <div class="well" ng-show="!loaded">

        <div class="row">
            <div class="col-sm-4">
            </div>
            <div class="col-sm-4">
                <h4>Loading</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-4">
            </div>
            <div class="col-sm-4">
                <img src="/Images/loader.gif" />
            </div>
        </div>
    </div>

    <div ng-show="loaded">
    	 <form class="form-horizontal css-form" role="form" novalidate>
    	  @foreach (var att in Model.Class.OwnedAttributes)
	{
	if (Model.RazorSupport.DataTypeIsElement(att.DataType))
		{		
    		if (Model.RazorSupport.GetElement(att.DataType) is IClass)
    		{
				var refclass=(IClass)Model.RazorSupport.GetElement(att.DataType);	

				var pKey=GetPrimaryKey(refclass);
				var descriptor=GetDescriptor(refclass);
				
				if (!string.IsNullOrEmpty(pKey) && !string.IsNullOrEmpty(descriptor))
				{
				 <div class="form-group">
                        <label for="@Model.Class.Name.LowerFirst()@att.Name" class="col-sm-2 control-label">Retailer</label>
                        <div class="col-sm-10">

                            <select id="@Model.Class.Name.LowerFirst()@att.Name" class="form-control" ng-model="@{@Model.Class.Name.LowerFirst()}.@{@refclass.Name}@pKey" ng-options="@{@refclass.Name.LowerFirst()}.@pKey as @{@refclass.Name.LowerFirst()}.@descriptor for @refclass.Name.LowerFirst() in @{@refclass.Name.LowerFirst()}s" required>
                                <option value="">-- Choose @refclass.Name --</option>
                            </select>
                        </div>
                    </div>
				}
				
				
    			
    		}
    	}
    	else
    	{
    	if (@att.Name!=GetPrimaryKey(Model.Class))
    	{
    	
    				<div class="form-group">
                        <label for="@Model.Class.Name.LowerFirst()@att.Name" class="col-sm-2 control-label">@att.Name</label>
                        <div class="col-sm-10">
                            <input id="@Model.Class.Name.LowerFirst()@att.Name" type="text" class="form-control" ng-model="@{@Model.Class.Name}View.@att.Name" required/>
                        </div>
                    </div>
                    }
    	
    	}    	
		
	}
    	 	  	
    	 </form>
    </div>

@functions{

string GetPrimaryKey(IClass iClass)
{
	foreach (var att2 in iClass.OwnedAttributes)
   	{
		if (att2["EF4","EF Primary Key"]=="True")
		 return att2.Name;
	}
	
	return "";
}

string GetDescriptor(IClass iClass)
{
	foreach (var att2 in iClass.OwnedAttributes)
   	{
		if (att2["EF4","Default Descriptor"]=="True")
		 return att2.Name;
	}
	
	return "";
}

}